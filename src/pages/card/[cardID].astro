---
import Footer from "../../components/Footer.astro";
import SearchLayout from "../../layouts/SearchLayout.astro";
import { SingleCardPage } from "../../components/SingleCardPage";
import type {
  CardMetadataWithVotes,
  SpecificCardDTO,
} from "../../../utils/apiTypes";

const { cardID } = Astro.params;
const requestParams = Astro.request.url.split("?")[1];
const params = new URLSearchParams(requestParams);
const collisions = params.get("collisions") ?? "";

const apiHost = import.meta.env.API_HOST as string;
let specificCards: SpecificCardDTO;

try {
  const specificCard = await fetch(`${apiHost}/card/${cardID ?? ""}`, {
    method: "GET",
  });
  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
  const specificCardJson: CardMetadataWithVotes = await specificCard.json();
  specificCards = { metadata: specificCardJson, status: specificCard.status };
} catch (e) {
  specificCards = { metadata: {}, status: 404 };
}
---

<SearchLayout>
  <SingleCardPage
    cardID={cardID}
    defaultResultCards={specificCards as {
      metadata: CardMetadataWithVotes;
      status: number;
    }}
    collisions={collisions}
    client:load
  />
  <div class="flex-1"></div>
  <Footer />
</SearchLayout>
